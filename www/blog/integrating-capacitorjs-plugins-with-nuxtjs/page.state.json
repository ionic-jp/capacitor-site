{"page.state":{"announcement_bar":{},"title":"Integrating CapacitorJS Plugins with NuxtJS","description":"Learn how to integrate Capacitor with NuxtJS","slug":"integrating-capacitorjs-plugins-with-nuxtjs","date":"2020-08-28T08:00:00.000Z","authorName":"Dan Pastori","authorUrl":"https://twitter.com/danpastori","html":"<blockquote> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">The following is a guest blog post from Dan Pastori of <a href=\"https://serversideup.net\">Server Side Up</a>. Server Side Up is an online community that shares tutorials and resources about Vuejs, Laravel, WordPress, and more recently have started creating resources on how to deliver native apps with Capacitor.</p> </blockquote> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3 paragraph-intro\">Using CapacitorJS with NuxtJS is a perfect combination. NuxtJS allows you to develop powerful, modern fronteneds using VueJS. Combined with CapacitorJS, you can take those modern frontends, compilie them to mobile, and deploy to the platform of your choice.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3 paragraph-intro\">Working with CapacitorJS, the power of native device features is there for you to integrate into your application. These features include GPS, Haptics, Camera, Filesystem, etc. When I structure a NuxtJS frontend, I like to design it in a way that allows me to re-use important modules through-out components, pages, and layouts.</p>  <h2 class=\"ui-heading ui-heading-2 ui-theme--editorial\" id=\"making-capacitorjs-plugins-globally-availble\"><a href=\"#making-capacitorjs-plugins-globally-availble\" class=\"heading-anchor\" aria-hidden=\"true\"></a>Making CapacitorJS Plugins Globally Availble</h2><p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">After you’ve run through the install of CapacitorJS, you have a variety of plugins available for you to <a href=\"https://capacitorjs.jp/docs/apis\">integrate into your app</a>. Let’s check out the <a href=\"https://capacitorjs.jp/docs/apis/geolocation\">Geolocation plugin</a> for a good example. To use the Geolocation plugin, you have to first import <code>Plugins</code> from the <code>@capacitor/core</code> library:</p> <pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Plugins <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@capacitor/core'</span><span class=\"token punctuation\">;</span></code></pre> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Then decouple the <code>Geolocation</code> plugin from the <code>Plugins</code> object:</p> <pre class=\"language-typescript\"><code><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Geolocation <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Plugins<span class=\"token punctuation\">;</span></code></pre> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">From here, you can make calls to the <code>Geolocation</code> plugin within your components. This works really well! However, in a NuxtJS setting I like to make these plugins globaly avaliable by wrapping them in a NuxtJS plugin. Why would you need to do this? Doesn’t this add more work? Besides allowing you to access the plugins globally which cleans up how much you need to import, there’s one main reason you’d do this: Server-side Rendering.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Server-side Rendering is extremely important if you using NuxtJS with CapacitorJS for mobile AND web. Besides the speed of your application, if you don’t server-side render, your app won’t be optimized for search engines. Since NuxtJS makes the headaches of SSR a thing of the past, let’s optimize our app to make use of both SSR and CapcitorJS Plugins.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Using <a href=\"https://nuxtjs.org/guide/plugins/#inject-in-root--context\">NuxtJS plugin architecture</a>, you can make a function available across the entire application. This is what we will be doing with the CapacitorJS plugins. Let’s use the Geolocation plugin as our example.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Within the root directory of your NuxtJS install, there’s a <code>/plugins</code> directory. In that directory add a file <code>geolocation.js</code> and populate it with the following code:</p> <pre class=\"language-typescript\"><code><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Plugins <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@capacitor/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Geolocation <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Plugins<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> app <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> inject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'CapacitorGeolocation'</span><span class=\"token punctuation\">,</span> Geolocation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">This should look very similar to how you would normally incorporate a CapacitorJS plugin into your application, however, we are wrapping it within a NuxtJS plugin. What this does is creates a function that accepts a decoupled <code>app</code> variable (your entire NuxtJS app), and an <code>inject()</code> method as parameters. We then take <code>inject()</code> method and pass two parameters. The first parameter is the key in how you will globally access the plugin (we will discuss soon). The second parameter is the <code>Geolocation</code> plugin from Capacitor that we included on top of our plugin.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">We now have a NuxtJS plugin that injects a CapacitorJS plugin globally. This will work with pretty much any of the CapacitorJS plugins. The next step is to make NuxtJS aware of this plugin and make sure we don’t run into any SSR errors!</p> <h2 class=\"ui-heading ui-heading-2 ui-theme--editorial\" id=\"preventing-server-side-rendering-ssr-errors\"><a href=\"#preventing-server-side-rendering-ssr-errors\" class=\"heading-anchor\" aria-hidden=\"true\"></a>Preventing Server-side Rendering (SSR) errors</h2><p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Now that we have our plugin created, we have to make NuxtJS aware of it. NuxtJS ships with a wonderful <code>nuxt.config.js</code> file that sits at the root of the install. In this file, there’s a key called <code>plugins</code> that contains an array.\nIn this array, we need to register our NuxtJS plugin that wraps our CapacitorJS plugin. To do that, add the following code:</p> <pre class=\"language-typescript\"><code>plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      src<span class=\"token operator\">:</span> <span class=\"token string\">'~/plugins/capacitor.js'</span><span class=\"token punctuation\">,</span>\n      mode<span class=\"token operator\">:</span> <span class=\"token string\">'client'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">The reason we chose this way is so we can use <code>mode: 'client'</code>. This is the crucial piece that makes CapacitorJS plugins work in your NuxtJS app without any SSR errors. So most CapacitorJS plugins require a Browser object to work with. When loading up the compiled code in the browser of your choice, this isn’t an issue, a Browser object exists. However, when server-side rendering your application, the Browser object does NOT exist. This will cause a variety of errors and your app won’t build correctly.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">The small object that we included in the <code>plugins</code> array includes a <code>src</code> key which is the source of the plugin. It also includes a <code>mode</code> key which is set to <code>client</code>. This will ignore the plugin if you are building it through SSR, but include the plugin in the final package when it’s sent to the browser.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">If you are just building a mobile application, you are probably just compiling as a Single Page Application. Choosing to compile as an SPA or SSR, the plugin will be included the same. If you are building a web and mobile application from the same code-base, you can swap out the compilation mode and your CapacitorJS plugin will work as expected!</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Now that we have our plugin registered globally, how do we access it?</p> <h2 class=\"ui-heading ui-heading-2 ui-theme--editorial\" id=\"accessing-plugins-within-nuxtjs-pages-and-components\"><a href=\"#accessing-plugins-within-nuxtjs-pages-and-components\" class=\"heading-anchor\" aria-hidden=\"true\"></a>Accessing Plugins within NuxtJS Pages and Components</h2><p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Since we have our plugin registered globally within our NuxtJS app, we can access it from any component. Let’s say we want to get the current coordinates of our user on all platforms. We’d call the following method within our component:</p> <pre class=\"language-typescript\"><code><span class=\"token keyword\">const</span> coordinates <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$CapacitorGeolocation<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentPosition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Since the method itself is asynchronous, we can use the <code>async/await</code> syntax and grab the coordinates. Let’s break down the structure of this method call: First we have <code>this</code> which references our NuxtJS application. Next, we reference the injected CapacitorJS Geolcation plugin by the name we provided, <code>$CapacitorGeolocation</code>. From there, we have full access to any of the CapacitorJS Geolocation plugin’s methods that have been documented! In this example we call the <code>getCurrentPosition()</code> method which returns the coordinates of the current user.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">By structuring the plugins this way, we can use either SPA/SSR build methods and have access to the CapacitorJS plugins from anywhere within the application. If you want to learn more aobut how to build an API along with your own Web + Mobile Applications, we have <a href=\"https://serversideup.net/ultimate-guide-to-building-apis-and-spas-with-laravel-and-vuejs/\">a book available</a>. In this book we go through the entire process of centralizing front end codebases and developing your own API with secure authentication practices. The book uses Laravel PHP for the API and NuxtJS + CapacitorJS for the frontend. You will learn how to build an app called ROAST which is available on the <a href=\"https://roastandbrew.coffee/\">web</a>, <a href=\"https://apps.apple.com/us/app/roast-brew-coffee/id1510419686\">iOS App Store</a> and <a href=\"https://play.google.com/store/apps/details?id=coffee.roastandbrew.mobile\">Android App Store</a> and browse the source code behind it.</p> <p class=\"ui-paragraph ui-paragraph--prose ui-paragraph-3\">Hope this helps and I can’t wait to see what gets created with CapacitorJS!</p>"},"components":["announcement-bar","site-backdrop","docs-dropdown","blog-subnav","blog-post","ion-icon","docs-search","more-button","site-header","site-root","capacitor-site"]}